<!DOCTYPE html>
<html>
<head>
    <title>Chat with Model</title>
    <style>
        /* 样式保持不变 */
    </style>
<script>
    function sendMessage(event) {
        event.preventDefault(); // 阻止表单的默认提交行为

        var messageInput = document.getElementById('message'); // 获取输入框元素
        var message = messageInput.value; // 获取输入的消息
        messageInput.value = ''; // 清空输入框

        var conversation = document.getElementById('conversation');
        conversation.innerHTML += '<b>用户:</b> ' + message + '<br>';

        var formData = new FormData();
        formData.append('message', message); // 添加文本消息

        var fileInput = document.getElementById('file');
        if (fileInput.files.length > 0) {
            var file = fileInput.files[0];
            formData.append('file', file); // 添加文件
        }

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/chat', true); // 配置请求

        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                // 请求成功，处理响应数据
                var response = JSON.parse(xhr.responseText);

                if (response && response.text) {
                    conversation.innerHTML += '<b>Ai助手:</b> ' + response.text + '<br>';
                } else {
                    conversation.innerHTML += '<b>Ai助手:</b> Response format error<br>';
                }
                
                conversation.scrollTop = conversation.scrollHeight; // 滚动到底部

                fileInput.value = ''; // 重置文件输入，取消文件选择
            }
        };

        xhr.send(formData); // 发送请求
    }
</script>
</head>

<body>
    <div id="conversation"></div> <!-- 对话记录 -->

    <form onsubmit="sendMessage(event)">
        <input type="text" id="message" name="message" placeholder="在此输入信息..." autofocus>
        <input type="file" id="file" name="file" style="display: inline-block;"> <!-- 文件上传 -->
        <input type="submit" value="发送">
    </form>

</body>
</html>
